<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diseños para 1 persona</title>
    
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #000;
            color: #fff;
            margin: 0;
            padding-top: 90px;
            text-align: center;
        }
        #chat-container {
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 300px;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: block;
            z-index: 1000;
        }
        
        #chat-header {
            background-color: #3498db;
            color: #fff;
            padding: 6px;
            text-align: center;
            cursor: pointer;
        }
        
        #chat-icon {
            width: 85px;
            height: 40px;
        }
        
        #chat-body {
            padding: 10px;
        }
        
        #chat-messages {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .user-message {
            font-size: 14px;
            background-color: #3498db;
            color: #000; /* Cambia el color del texto del cliente (negro en este caso) */
            padding: 5px;
            margin-bottom: 5px;
            border-radius: 5px;
            text-align: right; /* Alinea el texto del cliente a la derecha */
        }
        
        .bot-message {
            font-size: 14px;
            background-color: #f1f1f1;
            color: #000; /* Cambia el color del texto del bot (negro en este caso) */
            padding: 5px;
            margin-bottom: 5px;
            border-radius: 5px;
            text-align: left; /* Alinea el texto del bot a la izquierda */
        }
        
        #chat-input {
            display: flex;
            margin-top: 10px;
        }
        
        #user-input {
            flex: 1;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        
        #chat-input button {
            background-color: #3498db;
            color: #fff;
            border: none;
            padding: 5px 10px;
            margin-left: 5px;
            border-radius: 3px;
            cursor: pointer;
        }
        #toggleChatBtn {
            background: none;
            border: none;
            padding: 0;
        }
        #toggleChatBtn img {
            width: 20px;
            height: 20px;
        }
        
        .content {
            margin-top: 50px; /* Ajusta según la altura de tu menú */
        }

        .uploaded-images {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }

        .uploaded-images .image-container {
            margin: 5px;
            width: 100px; /* Ajusta el ancho según tus preferencias */
            height: 100px; /* Ajusta la altura según tus preferencias */
        }

        .uploaded-images img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 8px;
            cursor: pointer;
        }

        h1 {
            text-align: center;
            color: #555;
        }

    

        .image-gallery {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            margin-top: 20px;
        }

        .image-container {
            position: relative;
            margin: 10px;
        }

        .image-container img {
            max-width: 100%;
            border-radius: 8px;
            cursor: pointer;
        }

        #uploadForm {
            text-align: center;
            margin-top: 20px;
        }

        #imageInput {
            margin-right: 10px;
        }

        #uploadForm button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
        }

        #uploadForm button:hover {
            background-color: #45a049;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .design-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
        }

        .lock-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #333;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            z-index: 1000;
        }

        #codigoForm {
            text-align: center;
        }

        #codigo {
            padding: 8px;
            margin-right: 8px;
        }

        #lockScreen button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
        }

        p {
            text-align: center;
            margin: 10px 0;
        }


          
            
        #video-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            /* Aspect ratio 16:9 */
            margin: 0 auto;
            max-width: 80%;
        }

        #youtube-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        p {
            text-align: center;
            margin: 10px 0;
        }

        @media only screen and (max-width: 768px) {
            #video-container {
                padding-bottom: 75%;
                /* Adjust the aspect ratio for mobile */
            }
            
            
        }
    </style>
</head>
<body>
    {% include 'menu.html' %}
    <div class="content">
        <div id="chat-container">
            <div id="chat-header">
                <img src="{{ url_for('static', filename='chat.png') }}" alt="Chat Icon" id="chat-icon" onclick="toggleChat()">
            </div>
            <div id="chat-body">
                <div id="chat-messages"></div>
                <div id="chat-input">
                    <input type="text" id="user-input" placeholder="Escribe tu mensaje..." onkeydown="sendMessage(event)">
                    <button onclick="sendMessage()">Enviar</button>
                </div>
            </div>
        </div>
        <img src="https://i.postimg.cc/L6mKtYd0/logo-pagina-b.png" alt="Logo">
        <p><img src="{{ url_for('static', filename='info.png') }}" alt="Información" style="width: 20px; height: 20px;">IMPORTANTE: Antes de utilizar esta plataforma, mira el siguiente video </p>

        <div id="video-container">
            <iframe id="youtube-video" src="https://www.youtube.com/embed/FW7HFv_Qx8Q?si=4GOkC5hE2EnbamGj" frameborder="0"
                allowfullscreen></iframe>
            Tu navegador no soporta el elemento de video.
        </div>
        <p><img src="{{ url_for('static', filename='info2.png') }}" alt="Información" style="width: 20px; height: 20px;">Antes de utilizar esta plataforma, mira el video que está arriba</p>
        <div class="uploaded-images" id="uploadedImages"></div>

        <!-- Modifica el formulario de carga para incluir el evento onchange -->
        <form id="uploadForm" enctype="multipart/form-data">
            <input type="file" id="imageInput" accept=".jpg, .png, .jpeg" onchange="displayUploadedImages()" />
            <button type="button" onclick="uploadImage()">Subir rostro</button>
            <div class="loader" id="loader"></div>
        </form>

        <div class="image-container" id="imageContainer"></div>
        <div class="loader" id="pageLoader"></div>

        

        <script>
            // JavaScript para manejar la carga de archivos
            function uploadImage() {
                var input = document.getElementById('imageInput');
                var file = input.files[0];

                if (file) {
                    var formData = new FormData();
                    formData.append('file', file);

                    // Muestra el indicador de carga
                    document.getElementById('loader').style.display = 'inline-block';

                    // Puedes usar Fetch API o XMLHttpRequest para enviar la imagen a tu servidor Flask.
                    // Aquí hay un ejemplo usando Fetch:

                    fetch('/select_image', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Respuesta del servidor:', data);
                        // Puedes manejar la respuesta del servidor aquí

                        // Oculta el indicador de carga después de completar la carga
                        document.getElementById('loader').style.display = 'none';
                    })
                    .catch(error => {
                        console.error('Error al subir la imagen:', error);

                        // Oculta el indicador de carga en caso de error
                        document.getElementById('loader').style.display = 'none';
                    });
                } else {
                    console.log('No se seleccionó ninguna imagen.');
                }
            }
        </script>

        <div class="lock-screen" id="lockScreen">
            <form id="codigoForm">
                <p>Cada ingreso cuenta como 1 crédito<p>
                <label for="codigo"> - Ingrese el código:</label>
                <input type="password" id="codigo" name="codigo" required="">
                <button type="button" onclick="validarCodigo()">Desbloquear</button>
            </form>
        </div>

        <div class="image-gallery">
            {% for imagefilename in image_paths %}
                <div class="image-container">
                    <a href="{{ url_for('index') }}">
                        <img src="{{ url_for('static', filename='cuadruples/reducido/' + imagefilename) }}" alt="Image" onclick="procesarImagen('{{ imagefilename }}')">
                    </a>
                </div>
            {% endfor %}
            <footer style="background-color: #333; color: #fff; padding: 10px; text-align: center;">
                <p>Derechos de autor © 2024 Propicart. Todos los derechos reservados.</p>
            </footer>
            <div style="height: 150px;"></div>
        </div>
    </div>

    <script>
        console.log("Script JavaScript ejecutándose correctamente.");

        var codigosValidos = [];

        fetch('/obtener_codigos_validos')
            .then(response => response.json())
            .then(data => {
                codigosValidos = data.codigos;
            })
            .catch(error => {
                console.error('Error al obtener los códigos válidos:', error);
            });

        function validarCodigo() {
            var codigo = document.getElementById("codigo").value;
            
            fetch('/validar_codigo/' + codigo)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        document.getElementById("lockScreen").style.display = "none";
                        document.getElementById("gallery").style.display = "flex";
                    } else {
                        alert("Código no válido. Intente nuevamente o compre más créditos");
                    }
                })
                .catch(error => {
                    console.error('Error al validar el código:', error);
                });
        }

        function displayUploadedImages() {
            var input = document.getElementById('imageInput');
            var imagesContainer = document.getElementById('uploadedImages');

            // Mostrar las imágenes cargadas en cuadros más pequeños
            for (var i = 0; i < input.files.length; i++) {
                var imageContainer = document.createElement('div');
                imageContainer.classList.add('image-container');

                var image = document.createElement('img');
                image.src = URL.createObjectURL(input.files[i]);
                image.alt = 'Uploaded Image';

                imageContainer.appendChild(image);
                imagesContainer.appendChild(imageContainer);
            }
        }

        function procesarImagen(imageFilename) {
            var xhr = new XMLHttpRequest();

            xhr.open('POST', '{{ url_for('procesar') }}', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            var data = JSON.stringify({ 'imagefilename': imageFilename });

            xhr.onload = function () {
                if (xhr.status === 200) {
                    console.log(xhr.responseText);
                    alert("Nombre del archivo seleccionado: " + imageFilename);
                } else {
                    console.error("Error al procesar la imagen:", xhr.statusText);
                }
            };

            xhr.send(data);
        }
    </script>

   

    <script>
        console.log("Script JavaScript ejecutándose correctamente.");
    
        var isChatOpen = false;
    
        function toggleChat() {
            var chatBody = document.getElementById('chat-body');
            isChatOpen = !isChatOpen;
    
            if (isChatOpen) {
                chatBody.style.display = 'block';
                fetchResponse('¡Hola! ¿En qué puedo ayudarte?');
            } else {
                chatBody.style.display = 'none';
            }
        }
    
        function sendMessage(event) {
            if (event && event.key !== 'Enter') {
                return;
            }
    
            var userInput = document.getElementById('user-input').value;
            var chatMessages = document.getElementById('chat-messages');
    
            // Agrega el mensaje del usuario al chat
            chatMessages.innerHTML += '<div class="user-message">' + userInput + '</div>';
    
            // Limpia el campo de entrada
            document.getElementById('user-input').value = '';
    
            // Simula la respuesta del bot con un retraso y puntos suspensivos
            showBotTyping();
    
            setTimeout(function () {
                // Procesa el mensaje y obtén la respuesta
                var response = processMessage(userInput);
    
                // Oculta los puntos suspensivos después de mostrar la respuesta
                hideBotTyping();
    
                // Agrega la respuesta al chat
                chatMessages.innerHTML += '<div class="bot-message">' + response + '</div>';
    
                // Desplaza el chat automáticamente hacia la última respuesta
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 5000);
        }
    
        function showBotTyping() {
            var chatMessages = document.getElementById('chat-messages');
            chatMessages.innerHTML += '<div class="bot-message typing">...</div>';
        }
    
        function hideBotTyping() {
            var chatMessages = document.getElementById('chat-messages');
            var botTypingIndicator = chatMessages.querySelector('.bot-message.typing');
            if (botTypingIndicator) {
                botTypingIndicator.outerHTML = ''; // Elimina el elemento de puntos suspensivos
            }
        }
    
        function processMessage(message) {
            // Simulación de respuestas del bot
            if (message.toLowerCase().includes('hola', "buen día", "buenas tardes", "buenas noches", "que tal")) {
                return '¡Hola!, ¿cómo puedo ayudarte?';
            } else if (message.toLowerCase().includes('error', "eror", "problema")) {
                return 'Si te sale un mensaje de error es porque no estás cargando correctamente los rostros o las fotos de los rostros no son adecuadas. Asegurate de cargar las fotos INDIVIDUALMENTE y que el rostro se vea completo de frente. Sigue estos pasos: Cuando ingreses a la página, verás un video explicativo de 5 minutos. Ahí se detalla cómo cargar tus fotos en la página y descargar los diseños finales. También puedes acceder al video en el siguiente link <a href="https://www.youtube.com/watch?v=FW7HFv_Qx8Q&ab_channel=professionalPic" target="_blank">https://www.youtube.com/watch?v=FW7HFv_Qx8Q&ab_channel=professionalPic</a>. Los diseños son generados por nuestro sistema, no los crearás tú. Debes seguir los pasos del video para obtener un trabajo ordenado. Está diseñado así para que puedas elegir los diseños que más te gusten.';
            } else if (message.toLowerCase().includes('devolución', "devolucion", "dinero")) {
                return 'Lamentamos los inconvenientes. En términos y condiciones del servicio se detalla en qué casos se puede proceder a una devolución. Le invitamos a su lectura www.propicart.com/terminos. En caso considere que su caso está contemplado en casos de devolución, puede enviar evidencia, capturas de pantalla o archivos como prueba al correo professionalpic14@gmail.com, donde un asesor analizará su caso y le indicará si procede devolución';
            } else if (message.toLowerCase().includes("servidor", "server")) {
                return 'Por favor, vuelve a intentarlo más tarde (aprox. en 1 hora) ya que nuestro servidor está en mantenimiento';
            } else if (message.toLowerCase().includes("rostros", "rostro", "cara", "orden")) {
                return 'Los rostros se deben cargar de izquierda a derecha en cualquiera de los diseños. Sigue estos pasos: Cuando ingreses a la página, verás un video explicativo de 5 minutos. Ahí se detalla cómo cargar tus fotos en la página y descargar los diseños finales. Los diseños son generados por nuestro sistema, no los crearás tú. Debes seguir los pasos del video para obtener un trabajo ordenado. Está diseñado así para que puedas elegir los diseños que más te gusten.';
            } else if (message.toLowerCase().includes("comprar", "vender")) {
                return 'Si deseas comprar otro paquete u obtener alguna oferta en especial, comunica al correo professionalpic14@gmail.com';
            } else if (message.toLowerCase().includes("video")) {
                return ' Sigue estos pasos: Cuando ingreses a la página, verás un video explicativo de 5 minutos. Ahí se detalla cómo cargar tus fotos en la página y descargar los diseños finales. También puedes acceder al video en el siguiente link <a href="https://www.youtube.com/watch?v=FW7HFv_Qx8Q&ab_channel=professionalPic" target="_blank">https://www.youtube.com/watch?v=FW7HFv_Qx8Q&ab_channel=professionalPic</a>. Debes seguir los pasos del video para obtener un trabajo ordenado.';
            } else {
                return 'Por favor deja tu consulta detallando el problema por este chat. Si deseas una respuesta más detallada, puedes escribirnos por correo professionalpic14@gmail.com';
            }
        }
    </script>

</body>
</html>